<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UNICON – Messages</title>
  <link rel="icon" href="../UNICON.png?v=1758434378" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root{ --brand-color:#1D4E89; }
    body{ font-family:Inter, ui-sans-serif, system-ui; background:#fbf7f3; color:#0f172a; }
    .wm{position:fixed;inset:0;pointer-events:none;background-repeat:no-repeat;background-position:center;background-size:min(60vw,680px);opacity:.08;z-index:0}
    .btn-brand{ background:var(--brand-color); color:#fff; }
  </style>
</head>
<body class="antialiased">
  <div class="wm" style="background-image:url('../UNICON.png?v=1758434378')" aria-hidden="true"></div>
  <main class="relative z-10 min-h-screen px-4 py-6">
    <header class="max-w-6xl mx-auto mb-4 flex items-center gap-3 justify-between">
      <div class="hidden md:flex items-center gap-2 flex-1 max-w-xl">
        <div class="relative flex-1">
          <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input id="globalSearch" type="search" placeholder="Search…" class="w-full rounded-full border border-slate-200 bg-white px-10 py-2 text-sm" />
        </div>
      </div>
      <div class="relative flex items-center gap-2">
        <button title="Notifications" class="h-9 w-9 grid place-items-center rounded-full border border-slate-200 bg-white">🔔</button>
        <button id="userMenuBtn" title="Account" class="h-9 w-9 rounded-full border border-slate-200 bg-[var(--brand-color)] text-white grid place-items-center">👤</button>
        <div id="userMenu" class="hidden absolute right-0 top-12 w-60 rounded-2xl border border-slate-200 bg-white shadow-xl p-2">
          <a id="menuProfile" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-[var(--brand-color)]" href="javascript:void(0)">👤 Profile</a>
          <a id="menuSettings" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50" href="javascript:void(0)">⚙️ Settings</a>
          <a id="menuHome" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50" href="javascript:void(0)">🏠 My Home</a>
          <a id="menuHelp" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50" href="javascript:void(0)">❓ Help Center ↗</a>
          <div class="my-2 border-t"></div>
          <a id="menuLogout" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-rose-600" href="javascript:void(0)">Log Out</a>
        </div>
      </div>
    </header>
    <section class="max-w-6xl mx-auto">
      <div id="root"><div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">Loading…</div></div>
    </section>
  </main>

  <nav class="fixed bottom-3 left-1/2 -translate-x-1/2 z-40">
    <ul class="flex gap-1 bg-white/90 backdrop-blur border border-slate-200 rounded-2xl p-1 shadow-xl">
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="for-you.html">For you</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="community.html">Community</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm btn-brand" href="messages.html">Messages</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="marketplace.html">Marketplace</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="calendar.html">Calendar</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="profile.html">Profile</a></li>
    </ul>
</nav>
<script type="text/babel" data-presets="env,react">
  function getBranding(){ try { return JSON.parse(localStorage.getItem('uniconBrand')||'null'); }catch{ return null; } }
  function applyBranding(b){ const root = document.body; if (b?.color){ root.style.setProperty('--brand-color', b.color);} }
  const branding = getBranding(); applyBranding(branding);
  (function(){
    const menuBtn = document.getElementById('userMenuBtn');
    const menu = document.getElementById('userMenu');
    if(menuBtn && menu){ menuBtn.addEventListener('click', (e)=>{ e.stopPropagation(); menu.classList.toggle('hidden'); }); document.addEventListener('click', ()=> menu.classList.add('hidden')); }
    function nav(id, href){ const el=document.getElementById(id); if(!el) return; el.addEventListener('click', ()=>{ if(id==='menuLogout'){ try{ localStorage.removeItem('uniconSessionEmail'); }catch{} } location.href = href; }); }
    nav('menuProfile','profile.html'); nav('menuSettings','settings.html'); nav('menuHome','for-you.html'); const help=document.getElementById('menuHelp'); if(help) help.addEventListener('click', ()=> window.open('https://example.com/help','_blank'));
    const input = document.getElementById('globalSearch'); if(input){ const saved=localStorage.getItem('unicon_global_search')||''; if(saved) input.value=saved; input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ localStorage.setItem('unicon_global_search', input.value); try{ window.dispatchEvent(new CustomEvent('unicon_search',{ detail: input.value })); }catch{} } }); }
  })();
  function Moments(){
    const [threads, setThreads] = React.useState(()=>{ try{ return JSON.parse(localStorage.getItem('unicon_msgs_threads')||'null')||[{ id:'general', name:'Student Hub' }]; }catch{ return [{id:'general',name:'Student Hub'}]; } });
    const [active, setActive] = React.useState('general');
    const [msgs, setMsgs] = React.useState(()=>{ try{ return JSON.parse(localStorage.getItem('unicon_msgs')||'null')||{ general:[] }; }catch{ return { general:[] }; } });
    const [text, setText] = React.useState('');
    React.useEffect(()=>{ try{ localStorage.setItem('unicon_msgs', JSON.stringify(msgs)); }catch{} }, [msgs]);
    React.useEffect(()=>{ try{ localStorage.setItem('unicon_msgs_threads', JSON.stringify(threads)); }catch{} }, [threads]);
    const relTime = (ts)=>{ try{ const d=(Date.now()-ts)/1000; if(d<60) return `${Math.floor(d)}s`; if(d<3600) return `${Math.floor(d/60)}m`; if(d<86400) return `${Math.floor(d/3600)}h`; const dd=Math.floor(d/86400); return `${dd}d`; }catch{ return ''; } };
    function send(){ if(!text.trim()) return; const email=localStorage.getItem('uniconSessionEmail')||'You'; const m={ id:String(Date.now()), from:email, text, t:Date.now() }; setMsgs(s=> ({ ...s, [active]: [...(s[active]||[]), m] })); setText(''); }
    function addThread(){ const name=prompt('New conversation name'); if(!name) return; const id=String(Date.now()); setThreads(t=>[...t,{id,name}]); setMsgs(s=> ({...s,[id]:[]})); setActive(id); }
    function deleteThread(id){ if(id==='general') return; const {[id]:_, ...rest} = msgs; setMsgs(rest); setThreads(t=> t.filter(x=> x.id!==id)); if(active===id) setActive('general'); }
    const list = msgs[active]||[];
    return (
      <div className="grid md:grid-cols-[240px_1fr] gap-3">
        <aside className="rounded-xl border border-slate-200 bg-white p-2">
          <div className="flex items-center justify-between mb-2"><div className="text-sm font-semibold">Messages</div><button onClick={addThread} className="text-xs px-2 py-1 rounded border">New</button></div>
          <div className="space-y-1">
            {threads.map(t=> (
              <div key={t.id} className={`flex items-center gap-2 px-2 py-1 rounded-lg ${active===t.id?'chip-brand':'hover:bg-slate-50'}`}>
                <button onClick={()=>setActive(t.id)} className="flex-1 text-left text-sm py-1">{t.name}</button>
                {t.id!=='general' && <button title="Delete" onClick={()=>deleteThread(t.id)} className="text-xs px-2 py-0.5 rounded border">×</button>}
              </div>
            ))}
          </div>
        </aside>
        <section className="rounded-xl border border-slate-200 bg-white p-3 flex flex-col min-h-[300px]">
          <div className="font-medium mb-2">{(threads.find(t=>t.id===active)||{}).name||'Chat'}</div>
          <div className="flex-1 overflow-auto space-y-2 pr-1">
            {list.map(m=> (
              <div key={m.id} className={`max-w-[80%] rounded-lg px-3 py-2 ${m.from===localStorage.getItem('uniconSessionEmail')? 'ml-auto bg-[var(--brand-color)] text-white' : 'bg-slate-100'}`}>
                <div>{m.text}</div>
                <div className="mt-1 text-[10px] opacity-70">{m.from===localStorage.getItem('uniconSessionEmail')? 'You' : m.from} • {relTime(m.t)}</div>
              </div>
            ))}
            {list.length===0 && <div className="text-sm text-slate-500">No messages yet.</div>}
          </div>
          <div className="mt-2 flex gap-2"><input value={text} onChange={e=>setText(e.target.value)} onKeyDown={e=>{ if(e.key==='Enter') send(); }} placeholder="Write a message" className="flex-1 rounded-full border border-slate-300 px-3 py-2"/><button onClick={send} className="rounded-full px-4 py-2 btn-brand">Send</button></div>
        </section>
      </div>
    );
  }
  function MessagesPage(){ return (<div className="space-y-4"><Moments/></div>); }
  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(<MessagesPage/>);
</script>
</body>
</html>
