<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UNICON ‚Äì Calendar</title>
  <link rel="icon" href="../UNICON.png?v=1758434378" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root{ --brand-color:#1D4E89; }
    body{ font-family:Inter, ui-sans-serif, system-ui; background:#fbf7f3; color:#0f172a; }
    .wm{position:fixed;inset:0;pointer-events:none;background-repeat:no-repeat;background-position:center;background-size:min(60vw,680px);opacity:.08;z-index:0}
    .btn-brand{ background:var(--brand-color); color:#fff; }
  </style>
</head>
<body class="antialiased">
  <div class="wm" style="background-image:url('../UNICON.png?v=1758434378')" aria-hidden="true"></div>
  <main class="relative z-10 min-h-screen px-4 py-6">
    <header class="max-w-6xl mx-auto mb-4 flex items-center justify-between">
      <a href="index.html" class="text-sm text-slate-600 hover:underline">‚Üê Back to landing</a>
      <div class="text-sm text-slate-600">Calendar</div>
    </header>
    <section class="max-w-6xl mx-auto">
      <div id="root"><div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">Loading‚Ä¶</div></div>
    </section>
  </main>

  <nav class="fixed bottom-3 left-1/2 -translate-x-1/2 z-40">
    <ul class="flex gap-1 bg-white/90 backdrop-blur border border-slate-200 rounded-2xl p-1 shadow-xl">
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="for-you.html">For you</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="community.html">Community</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="messages.html">Messages</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="marketplace.html">Marketplace</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm btn-brand" href="calendar.html">Calendar</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="profile.html">Profile</a></li>
    </ul>
</nav>
<script type="text/babel" data-presets="env,react">
  const { useState } = React;
  function getBranding(){ try { return JSON.parse(localStorage.getItem('uniconBrand')||'null'); }catch{ return null; } }
  function applyBranding(b){ const root = document.body; if (b?.color){ root.style.setProperty('--brand-color', b.color);} }
  const branding = getBranding(); applyBranding(branding);

  function CalendarTab(){
    const [events, setEvents] = useState(()=>{ try{ return JSON.parse(localStorage.getItem('unicon_events')||'null') || [];}catch{ return []; } });
    const today = new Date();
    const [view, setView] = useState(()=> new Date(today.getFullYear(), today.getMonth(), 1));
    const y = view.getFullYear();
    const m = view.getMonth();
    const first = new Date(y, m, 1);
    const startDay = first.getDay();
    const daysInMonth = new Date(y, m+1, 0).getDate();
    const cells = [];
    for(let i=0;i<startDay;i++) cells.push(null);
    for(let d=1; d<=daysInMonth; d++) cells.push(new Date(y,m,d));
    const byDate = (date)=> events.filter(ev=> {
      const s = ev.start ? new Date(ev.start) : (ev.time? new Date(ev.time) : null);
      if(!s) return false;
      const e = ev.end ? new Date(ev.end) : s;
      const d0 = new Date(date.getFullYear(),date.getMonth(),date.getDate());
      const ds = new Date(s.getFullYear(),s.getMonth(),s.getDate());
      const de = new Date(e.getFullYear(),e.getMonth(),e.getDate());
      return d0>=ds && d0<=de;
    });
    const fmtDate = (d)=> new Date(d).toLocaleDateString(undefined,{ month:'short', day:'2-digit', year:'numeric' });
    const formatRange = (ev)=>{
      if (ev.start){
        if (ev.end && ev.end!==ev.start){
          const s = new Date(ev.start); const e = new Date(ev.end);
          const sameMonth = s.getFullYear()===e.getFullYear() && s.getMonth()===e.getMonth();
          if (sameMonth){
            const mname = s.toLocaleString(undefined,{ month:'short' });
            return `${mname} ${String(s.getDate()).padStart(2,'0')}‚Äì${e.getDate()}, ${e.getFullYear()}`;
          }
          return `${fmtDate(ev.start)} ‚Äì ${fmtDate(ev.end)}`;
        }
        return fmtDate(ev.start);
      }
      return ev.time || '';
    };

    const recs = events.slice(0,6);

    return (
      <div className="space-y-4">
        <div className="bg-white rounded-xl border border-slate-200 p-4">
          <div className="flex items-center justify-between mb-2">
            <div className="text-xl font-semibold">{view.toLocaleString(undefined,{ month:'long', year:'numeric' })}</div>
            <div className="flex items-center gap-2">
              <button onClick={()=> setView(v=> new Date(v.getFullYear(), v.getMonth()-1, 1))} className="rounded-md border px-2 py-1">Prev</button>
              <button onClick={()=> setView(v=> new Date(v.getFullYear(), v.getMonth()+1, 1))} className="rounded-md border px-2 py-1">Next</button>
            </div>
          </div>
          <div className="grid grid-cols-7 gap-px bg-slate-200 rounded-lg overflow-hidden">
            {['Sun','Mon','Tue','Wed','Thu','Fri','Sat'].map(d=> (<div key={d} className="bg-slate-50 text-center text-xs py-2 font-medium">{d}</div>))}
            {cells.map((d,i)=> (
              <div key={i} className="bg-white min-h-[84px] p-1">
                {d && (
                  <>
                    <div className="text-xs text-slate-500">{d.getDate()}</div>
                    <div className="mt-1 space-y-1">
                      {byDate(d).map(ev=> (
                        <div key={ev.id} className="text-[10px] bg-slate-100 rounded px-1 py-0.5 text-slate-700 truncate" title={ev.title}>{ev.title}</div>
                      ))}
                    </div>
                  </>
                )}
              </div>
            ))}
          </div>
        </div>

        <div className="bg-white rounded-xl border border-slate-200 p-4">
          <div className="flex items-center justify-between mb-2"><div className="text-lg font-semibold">Recommended events</div></div>
          <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3">
            {recs.length? recs.map(ev=> (
              <div key={ev.id} className="rounded-xl border border-slate-200 bg-white p-4">
                <div className="font-semibold text-slate-900">{ev.title}</div>
                <div className="text-xs text-slate-600 mt-1">üìÖ {formatRange(ev)}</div>
                <p className="text-sm text-slate-700 mt-2 line-clamp-3">{ev.desc || 'Campus activity'}</p>
                <div className="mt-2 text-xs text-slate-500">üë• {Math.floor(Math.random()*80)+1}</div>
              </div>
            )) : (
              [1,2,3,4,5,6].map(i=> <div key={i} className="rounded-xl border border-slate-200 bg-white p-4"><div className="font-semibold">Community meetup</div><div className="text-xs text-slate-600 mt-1">TBD</div><p className="text-sm text-slate-700 mt-2">Join peers for a session.</p></div>)
            )}
          </div>
        </div>
      </div>
    );
  }
  function CalendarPage(){ return (<div className="space-y-4"><CalendarTab/></div>); }
  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(<CalendarPage/>);
</script>
</body>
</html>
