<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UNICON ‚Äì Profile</title>
  <link rel="icon" href="../UNICON.png?v=1758434378" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root{ --brand-color:#1D4E89; --bg:#fbf7f3; --card:#ffffff; --text:#0f172a; --muted:#475569; --border:#e2e8f0; }
    body{ font-family:Inter, ui-sans-serif, system-ui; background:var(--bg); color:var(--text); }
    .wm{position:fixed;inset:0;pointer-events:none;background-repeat:no-repeat;background-position:center;background-size:min(60vw,680px);opacity:.08;z-index:0}
    .btn-brand{ background:var(--brand-color); color:#fff; }
    .shadow-card{ box-shadow: 0 8px 20px rgba(0,0,0,.06); }
  </style>
</head>
<body class="antialiased">
  <div class="wm" style="background-image:url('../UNICON.png?v=1758434378')" aria-hidden="true"></div>
  <main class="relative z-10 min-h-screen px-4 py-6">
    <header class="max-w-6xl mx-auto mb-4 flex items-center justify-between">
      <a href="index.html" class="text-sm text-slate-600 hover:underline">‚Üê Back to landing</a>
      <div class="text-sm text-slate-600">Profile</div>
    </header>
    <section class="max-w-6xl mx-auto">
      <div id="root">
        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">Loading‚Ä¶</div>
      </div>
    </section>
  </main>

  <nav class="fixed bottom-3 left-1/2 -translate-x-1/2 z-40">
    <ul class="flex gap-1 bg-white/90 backdrop-blur border border-slate-200 rounded-2xl p-1 shadow-xl">
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="for-you.html">For you</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="community.html">Community</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="messages.html">Messages</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="marketplace.html">Marketplace</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="calendar.html">Calendar</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm btn-brand" href="profile.html">Profile</a></li>
    </ul>
  </nav>

  <script type="text/babel" data-presets="env,react">
    const { useState } = React;
    function getBranding(){ try { return JSON.parse(localStorage.getItem('uniconBrand')||'null'); }catch{ return null; } }
    function applyBranding(b){ const root = document.body; if (b?.color){ root.style.setProperty('--brand-color', b.color);} }
    const branding = getBranding(); applyBranding(branding);
    function toast(message, type='info'){ try{ window.dispatchEvent(new CustomEvent('unicon_toast', { detail:{ message, type, id:String(Date.now()) } })); }catch{} }
    async function compressImage(dataUrl, max=1600){
      try{
        const img = new Image(); img.src = dataUrl; await new Promise(r=>{ img.onload=r; img.onerror=r; });
        const w = img.width, h = img.height; const scale = Math.min(1, max/Math.max(w,h));
        if(scale>=1) return dataUrl;
        const canvas = document.createElement('canvas'); canvas.width = Math.round(w*scale); canvas.height = Math.round(h*scale);
        const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        return canvas.toDataURL('image/jpeg', 0.85);
      }catch{ return dataUrl; }
    }

    function Profile(){
      const [profile, setProfile] = useState(()=>{
        try { return JSON.parse(localStorage.getItem('uniconProfile')||'null') || { name:'Student User', email: localStorage.getItem('uniconSessionEmail'), bio:'', year:'', major:'', avatar:'üë§' }; } catch { return { name:'Student User', email: localStorage.getItem('uniconSessionEmail'), bio:'', year:'', major:'', avatar:'üë§' }; }
      });
      const [msg, setMsg] = useState('');
      const email = localStorage.getItem('uniconSessionEmail') || 'default';
      const storageKey = `unicon_profile_posts:${email}`;
      const [posts, setPosts] = useState(()=>{ try{ return JSON.parse(localStorage.getItem(storageKey)||'null') || []; }catch{ return []; } });
      React.useEffect(()=>{ try{ localStorage.setItem(storageKey, JSON.stringify(posts)); }catch{} }, [posts]);
      const [postText, setPostText] = useState('');
      const [postMedia, setPostMedia] = useState('');
      const mediaRef = React.useRef(null);
      function update(field, value){ setProfile(p=>({ ...p, [field]: value })); }
      function save(){ try{ localStorage.setItem('uniconProfile', JSON.stringify(profile)); setMsg('Saved'); setTimeout(()=>setMsg(''), 1200);}catch{} }
      async function changeAvatar(e){ const f=e.target.files&&e.target.files[0]; if(!f) return; const data = await new Promise(res=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(f); }); const small = await compressImage(data, 1600); update('avatar', small); }
      const fileRef = React.useRef(null);
      function changeMedia(e){ const f=e.target.files&&e.target.files[0]; if(!f) return; const r=new FileReader(); r.onload=()=> setPostMedia(r.result); r.readAsDataURL(f); }
      function submitPost(){ if(!postText.trim() && !postMedia) return; setPosts([{ id:String(Date.now()), text:postText, media:postMedia, created:new Date().toISOString() }, ...posts]); setPostText(''); setPostMedia(''); if(mediaRef.current) mediaRef.current.value=''; }
      function removePost(id){ setPosts(arr=> arr.filter(p=> p.id!==id)); }
      return (
        <div className="bg-white rounded-2xl border border-slate-200 p-5 space-y-4">
          <div className="flex items-start gap-4">
            <div className="relative h-16 w-16">
              {String(profile.avatar||'').startsWith('data:') ? (
                <img src={profile.avatar} className="h-16 w-16 rounded-full object-cover border border-slate-200" alt="avatar"/>
              ) : (
                <div className="h-16 w-16 rounded-full grid place-items-center text-2xl bg-slate-100 border border-slate-200" aria-hidden>{profile.avatar||'üë§'}</div>
              )}
              <button type="button" onClick={()=>fileRef.current && fileRef.current.click()} title="Add photo" className="absolute -bottom-1 -right-1 h-7 w-7 rounded-full btn-brand grid place-items-center text-base leading-none shadow ring-2 ring-white">+</button>
              <input ref={fileRef} type="file" accept="image/*" onChange={changeAvatar} className="hidden" />
            </div>
            <div className="flex-1 grid md:grid-cols-2 gap-3">
              <label className="block text-sm">Full name<input value={profile.name||''} onChange={e=>update('name', e.target.value)} className="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2"/></label>
              <label className="block text-sm">Email<input disabled value={profile.email||''} className="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2 bg-slate-50"/></label>
              <label className="block text-sm">Year<input value={profile.year||''} onChange={e=>update('year', e.target.value)} className="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2"/></label>
              <label className="block text-sm">Major<input value={profile.major||''} onChange={e=>update('major', e.target.value)} className="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2"/></label>
              <label className="md:col-span-2 block text-sm">Bio<textarea value={profile.bio||''} onChange={e=>update('bio', e.target.value)} rows="3" className="mt-1 w-full rounded-xl border border-slate-300 px-3 py-2"/></label>
              <div className="md:col-span-2 flex items-center gap-2"><button onClick={save} className="rounded-full px-4 py-2 btn-brand">Save</button>{msg && <span className="text-sm text-green-700">{msg}</span>}</div>
            </div>
          </div>

          <div className="rounded-2xl border border-slate-200">
            <div className="px-4 py-3">Create post</div>
            <div className="px-4 pb-3 flex items-start gap-3">
              {String(profile.avatar||'').startsWith('data:') ? (
                <img src={profile.avatar} className="h-10 w-10 rounded-full object-cover border border-slate-200" alt="avatar"/>
              ) : (
                <div className="h-10 w-10 rounded-full grid place-items-center text-lg bg-slate-100 border border-slate-200" aria-hidden>{(profile.avatar||'üë§')}</div>
              )}
              <div className="flex-1">
                <input value={postText} onChange={e=>setPostText(e.target.value)} placeholder="What's on your mind?" className="w-full rounded-full border border-slate-200 bg-slate-50 px-4 py-2 text-slate-700"/>
                {postMedia && (<div className="mt-3"><img src={postMedia} alt="preview" className="max-h-56 rounded-lg object-cover"/></div>)}
              </div>
              {(postText.trim() || postMedia) && <button onClick={submitPost} className="ml-2 rounded-full px-4 py-2 btn-brand">Post</button>}
            </div>
            <div className="border-t border-slate-200 px-4 py-3 grid md:grid-cols-3 gap-2 text-sm">
              <button onClick={()=>toast('Live video is coming soon!','info')} className="rounded-lg px-3 py-2 bg-slate-50 hover:bg-slate-100 text-slate-700 text-left">üìπ Live video</button>
              <button onClick={()=>mediaRef.current && mediaRef.current.click()} className="rounded-lg px-3 py-2 bg-slate-50 hover:bg-slate-100 text-slate-700 text-left">üñºÔ∏è Photo/video</button>
              <button onClick={()=> setPostText(t=> t || 'üéâ Life event: ')} className="rounded-lg px-3 py-2 bg-slate-50 hover:bg-slate-100 text-slate-700 text-left">üö© Life event</button>
              <input ref={mediaRef} type="file" accept="image/*,video/*" className="hidden" onChange={changeMedia} />
            </div>
          </div>

          <div className="space-y-3">
            {posts.map(p=> (
              <div key={p.id} className="rounded-xl border border-slate-200 bg-white p-4">
                <div className="flex items-center justify-between text-xs text-slate-500"><span>Your post</span><button onClick={()=>removePost(p.id)} className="hover:underline">Delete</button></div>
                {p.text && <div className="mt-1 text-slate-800">{p.text}</div>}
                {p.media && <div className="mt-2"><img src={p.media} alt="media" className="max-h-72 rounded-lg object-cover"/></div>}
              </div>
            ))}
            {posts.length===0 && <div className="text-sm text-slate-500">No posts yet. Share something above.</div>}
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Profile/>);
  </script>
</body>
</html>
