<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UNICON – Profile</title>
  <link rel="icon" href="../UNICON.png?v=1758434378" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root{ --brand-color:#1D4E89; --bg:#fbf7f3; --card:#ffffff; --text:#0f172a; --muted:#475569; --border:#e2e8f0; }
    body{ font-family:Inter, ui-sans-serif, system-ui; background:var(--bg); color:var(--text); }
    .wm{position:fixed;inset:0;pointer-events:none;background-repeat:no-repeat;background-position:center;background-size:min(60vw,680px);opacity:.08;z-index:0}
    .btn-brand{ background:var(--brand-color); color:#fff; }
    .shadow-card{ box-shadow: 0 8px 20px rgba(0,0,0,.06); }
  </style>
</head>
<body class="antialiased">
  <div class="wm" style="background-image:url('../UNICON.png?v=1758434378')" aria-hidden="true"></div>
  <main class="relative z-10 min-h-screen px-4 py-6">
    <header class="max-w-6xl mx-auto mb-4 flex items-center gap-3 justify-between">
      <div class="hidden md:flex items-center gap-2 flex-1 max-w-xl">
        <div class="relative flex-1">
          <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input id="globalSearch" type="search" placeholder="Search…" class="w-full rounded-full border border-slate-200 bg-white px-10 py-2 text-sm" />
        </div>
      </div>
      <div class="relative flex items-center gap-2">
        <button title="Notifications" class="h-9 w-9 grid place-items-center rounded-full border border-slate-200 bg-white">🔔</button>
        <button id="userMenuBtn" title="Account" class="h-9 w-9 rounded-full border border-slate-200 bg-[var(--brand-color)] text-white grid place-items-center">👤</button>
        <div id="userMenu" class="hidden absolute right-0 top-12 w-60 rounded-2xl border border-slate-200 bg-white shadow-xl p-2">
          <a id="menuProfile" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-[var(--brand-color)]" href="javascript:void(0)">👤 Profile</a>
          <a id="menuSettings" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50" href="javascript:void(0)">⚙️ Settings</a>
          <a id="menuHome" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50" href="javascript:void(0)">🏠 My Home</a>
          <a id="menuHelp" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50" href="javascript:void(0)">❓ Help Center ↗</a>
          <div class="my-2 border-t"></div>
          <a id="menuLogout" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-rose-600" href="javascript:void(0)">Log Out</a>
        </div>
      </div>
    </header>
    <section class="max-w-6xl mx-auto">
      <div id="root">
        <div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">Loading…</div>
      </div>
    </section>
  </main>

  <nav class="fixed bottom-3 left-1/2 -translate-x-1/2 z-40">
    <ul class="flex gap-1 bg-white/90 backdrop-blur border border-slate-200 rounded-2xl p-1 shadow-xl">
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="for-you.html">For you</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="community.html">Community</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="messages.html">Messages</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="marketplace.html">Marketplace</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="calendar.html">Calendar</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm btn-brand" href="profile.html">Profile</a></li>
    </ul>
  </nav>

  <script type="text/babel" data-presets="env,react">
    const { useState } = React;
    function getBranding(){ try { return JSON.parse(localStorage.getItem('uniconBrand')||'null'); }catch{ return null; } }
    function applyBranding(b){ const root = document.body; if (b?.color){ root.style.setProperty('--brand-color', b.color);} }
    const branding = getBranding(); applyBranding(branding);
    (function(){
      const menuBtn = document.getElementById('userMenuBtn');
      const menu = document.getElementById('userMenu');
      if(menuBtn && menu){ menuBtn.addEventListener('click', (e)=>{ e.stopPropagation(); menu.classList.toggle('hidden'); }); document.addEventListener('click', ()=> menu.classList.add('hidden')); }
      function nav(id, href){ const el=document.getElementById(id); if(!el) return; el.addEventListener('click', ()=>{ if(id==='menuLogout'){ try{ localStorage.removeItem('uniconSessionEmail'); }catch{} } location.href = href; }); }
      nav('menuProfile','profile.html'); nav('menuSettings','settings.html'); nav('menuHome','for-you.html'); const help=document.getElementById('menuHelp'); if(help) help.addEventListener('click', ()=> window.open('https://example.com/help','_blank'));
      const input = document.getElementById('globalSearch'); if(input){ const saved=localStorage.getItem('unicon_global_search')||''; if(saved) input.value=saved; input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ localStorage.setItem('unicon_global_search', input.value); try{ window.dispatchEvent(new CustomEvent('unicon_search',{ detail: input.value })); }catch{} } }); }
    })();
    function toast(message, type='info'){ try{ window.dispatchEvent(new CustomEvent('unicon_toast', { detail:{ message, type, id:String(Date.now()) } })); }catch{} }
    async function compressImage(dataUrl, max=1600){
      try{
        const img = new Image(); img.src = dataUrl; await new Promise(r=>{ img.onload=r; img.onerror=r; });
        const w = img.width, h = img.height; const scale = Math.min(1, max/Math.max(w,h));
        if(scale>=1) return dataUrl;
        const canvas = document.createElement('canvas'); canvas.width = Math.round(w*scale); canvas.height = Math.round(h*scale);
        const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        return canvas.toDataURL('image/jpeg', 0.85);
      }catch{ return dataUrl; }
    }

    function Profile(){
      // base profile data
      const [profile, setProfile] = useState(()=>{
        try { return JSON.parse(localStorage.getItem('uniconProfile')||'null') || { name:'Student User', email: localStorage.getItem('uniconSessionEmail'), username:(localStorage.getItem('uniconSessionEmail')||'user').split('@')[0], bio:'', category:'Student', website:'', avatar:'👤', followers:234, following:167 }; } catch { return { name:'Student User', email: localStorage.getItem('uniconSessionEmail'), username:(localStorage.getItem('uniconSessionEmail')||'user').split('@')[0], bio:'', category:'Student', website:'', avatar:'👤', followers:234, following:167 }; }
      });
      const email = localStorage.getItem('uniconSessionEmail') || 'default';
      const storageKey = `unicon_profile_posts:${email}`;
      const [posts, setPosts] = useState(()=>{ try{ return JSON.parse(localStorage.getItem(storageKey)||'null') || []; }catch{ return []; } });
      React.useEffect(()=>{ try{ localStorage.setItem(storageKey, JSON.stringify(posts)); }catch{} }, [posts]);
      // saved posts map
      const savedKey = `unicon_profile_saved:${email}`;
      const [saved, setSaved] = useState(()=>{ try{ return JSON.parse(localStorage.getItem(savedKey)||'null') || {}; }catch{ return {}; } });
      React.useEffect(()=>{ try{ localStorage.setItem(savedKey, JSON.stringify(saved)); }catch{} }, [saved]);
      // follow state
      const followKey = `unicon_follow:${email}`;
      const [followed, setFollowed] = useState(()=>{ try{ return !!JSON.parse(localStorage.getItem(followKey)||'false'); }catch{ return false; } });
      React.useEffect(()=>{ try{ localStorage.setItem(followKey, JSON.stringify(followed)); }catch{} }, [followed]);
      // composer state
      const [caption, setCaption] = useState('');
      const [image, setImage] = useState('');
      const imgRef = React.useRef(null);
      const avatarRef = React.useRef(null);
      function saveProfile(p){ try{ localStorage.setItem('uniconProfile', JSON.stringify(p)); }catch{} setProfile(p); }
      async function onAvatar(e){ const f=e.target.files&&e.target.files[0]; if(!f) return; const data = await new Promise(res=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(f); }); const small = await compressImage(data, 800); saveProfile({ ...profile, avatar: small }); }
      async function onImage(e){ const f=e.target.files&&e.target.files[0]; if(!f) return; const data = await new Promise(res=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.readAsDataURL(f); }); const small = await compressImage(data, 1600); setImage(small); }
      function addPost(){ if(!image) return; setPosts([{ id:String(Date.now()), media:image, text:caption, created:Date.now() }, ...posts]); setCaption(''); setImage(''); if(imgRef.current) imgRef.current.value=''; }
      function removePost(id){ setPosts(arr=> arr.filter(p=> p.id!==id)); }
      // modal for viewing
      const [view, setView] = useState(null);
      // tabs
      const [tab, setTab] = useState('grid');
      // edit profile modal
      const [editing, setEditing] = useState(false);
      const [draft, setDraft] = useState(profile);

      // header stats
      const postCount = posts.length;

      // helper render avatar
      const Avatar = ({ size=72 }) => (
        String(profile.avatar||'').startsWith('data:')
          ? <img src={profile.avatar} className="rounded-full object-cover border border-slate-200" style={{width:size, height:size}} alt="avatar"/>
          : <div className="rounded-full grid place-items-center bg-slate-100 border border-slate-200" style={{width:size, height:size, fontSize: size*0.4}} aria-hidden>{profile.avatar||'👤'}</div>
      );

      const highlights = posts.filter(p=>p.media).slice(0,6);

      return (
        <div className="bg-white rounded-2xl border border-slate-200 p-0 overflow-hidden">
          {/* Top bar */}
          <div className="px-4 py-3 border-b border-slate-200 flex items-center justify-between">
            <div className="font-semibold flex items-center gap-2">
              {profile.username || 'username'}
              {String(profile.email||'').endsWith('.edu') && <span title="Verified" className="text-xs px-2 py-0.5 rounded-full border border-slate-300">✓</span>}
            </div>
            <div className="flex items-center gap-2">
              <button onClick={()=>{ setDraft(profile); setEditing(true); }} className="rounded-full px-3 py-1 text-sm border">Edit Profile</button>
              <input ref={avatarRef} type="file" accept="image/*" className="hidden" onChange={onAvatar}/>
            </div>
          </div>

          {/* Header */}
          <div className="px-4 py-4 grid grid-cols-[96px_1fr] gap-4">
            <div className="grid place-items-center"><Avatar size={84}/></div>
            <div>
              <div className="grid grid-cols-3 text-center">
                <div><div className="font-semibold">{postCount}</div><div className="text-xs text-slate-500">Posts</div></div>
                <div><div className="font-semibold">{profile.followers||0}</div><div className="text-xs text-slate-500">Followers</div></div>
                <div><div className="font-semibold">{profile.following||0}</div><div className="text-xs text-slate-500">Following</div></div>
              </div>
              <div className="mt-3">
                <div className="font-semibold">{profile.name}</div>
                {profile.category && <div className="text-xs text-slate-600">{profile.category}</div>}
                {profile.bio && <p className="text-sm text-slate-700 mt-1 whitespace-pre-wrap">{profile.bio}</p>}
                {profile.website && <a href={profile.website} target="_blank" rel="noreferrer" className="text-sm text-[var(--brand-color)] underline">{profile.website}</a>}
              </div>
              <div className="mt-3 flex items-center gap-2">
                <button onClick={()=>{ setFollowed(f=>!f); saveProfile({ ...profile, followers: Math.max(0,(profile.followers||0) + (followed? -1 : 1)) }); }} className={`rounded-full px-3 py-1 text-sm ${followed? 'border' : 'btn-brand'}`}>{followed? 'Following':'Follow'}</button>
                <a href="messages.html" className="rounded-full px-3 py-1 text-sm border">Message</a>
                <button className="rounded-full px-3 py-1 text-sm border" onClick={()=>alert('Contact: '+(profile.email||''))}>Contact</button>
              </div>
            </div>
          </div>

          {/* Highlights */}
          <div className="px-4 pb-3 overflow-x-auto">
            <div className="flex items-center gap-4">
              {highlights.length===0 && (
                <div className="text-sm text-slate-500">Add a post to create highlights.</div>
              )}
              {highlights.map((h,i)=> (
                <div key={h.id} className="flex-shrink-0 text-center">
                  <div className="h-16 w-16 rounded-full border-2 border-slate-300 p-0.5">
                    <img src={h.media} className="h-full w-full rounded-full object-cover"/>
                  </div>
                  <div className="text-[10px] text-slate-600 mt-1 max-w-16 truncate">{(h.text||'Highlight')}</div>
                </div>
              ))}
            </div>
          </div>

          {/* Actions + Composer */}
          <div className="px-4 py-3 border-t border-slate-200 grid md:grid-cols-[1fr_auto] gap-3 items-start">
            <div className="flex items-center gap-2">
              <input value={caption} onChange={e=>setCaption(e.target.value)} placeholder="Write a caption (optional)" className="flex-1 rounded-full border border-slate-300 px-3 py-2"/>
              <input ref={imgRef} type="file" accept="image/*" onChange={onImage}/>
              <button onClick={addPost} className="rounded-full px-4 py-2 btn-brand">Add Post</button>
            </div>
            {image && <img src={image} className="h-16 w-16 object-cover rounded" alt="preview"/>}
          </div>

          {/* Tabs (only grid for now) */}
          <div className="px-4 pt-3">
            <div className="flex items-center gap-4 text-sm text-slate-600">
              <button className={`${tab==='grid'?'font-semibold text-slate-900':'hover:underline'}`} onClick={()=>setTab('grid')}>Grid</button>
              <button className={`${tab==='saved'?'font-semibold text-slate-900':'hover:underline'}`} onClick={()=>setTab('saved')}>Saved</button>
              <button className="opacity-50 cursor-default" title="Coming soon" disabled>Tagged</button>
            </div>
          </div>

          {/* Grid */}
          <div className="p-1 grid grid-cols-3 gap-1">
            {tab==='grid' && posts.filter(p=>p.media).length===0 && (
              <div className="col-span-3 text-center text-sm text-slate-500 py-10">No posts yet.</div>
            )}
            {(tab==='grid'? posts.filter(p=>p.media) : posts.filter(p=> saved[p.id])).map(p=> (
              <div key={p.id} className="relative group overflow-hidden bg-slate-100" style={{ aspectRatio:'1 / 1' }}>
                <button className="absolute top-1 right-1 z-10 rounded-md bg-white/90 border px-1 text-xs" onClick={()=> setSaved(s=> ({...s,[p.id]: !s[p.id]}))}>{saved[p.id]? '♥':'♡'}</button>
                <button className="absolute inset-0" onClick={()=>setView(p)} aria-label="Open post"></button>
                <img src={p.media} alt="post" className="h-full w-full object-cover group-hover:scale-105 transition-transform"/>
                {p.text && <div className="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity grid place-items-center text-white text-xs px-2 text-center">{p.text}</div>}
              </div>
            ))}
          </div>

          {/* Post modal */}
          {view && (
            <div className="fixed inset-0 z-50 bg-black/50 grid place-items-center p-3" onClick={()=>setView(null)}>
              <div className="bg-white rounded-2xl border border-slate-200 max-w-3xl w-full grid md:grid-cols-2 overflow-hidden" onClick={(e)=>e.stopPropagation()}>
                <div className="bg-black grid place-items-center"><img src={view.media} className="max-h-[80vh] object-contain"/></div>
                <div className="p-4 flex flex-col">
                  <div className="flex items-center gap-2 mb-2"><Avatar size={36}/><div className="font-medium">{profile.username}</div></div>
                  {view.text && <div className="text-sm text-slate-800 whitespace-pre-wrap">{view.text}</div>}
                  <div className="mt-auto flex items-center justify-between text-xs text-slate-500">
                    <span>{new Date(view.created||Date.now()).toLocaleString()}</span>
                    <div className="flex items-center gap-2">
                      <button onClick={()=> setSaved(s=> ({...s,[view.id]: !s[view.id]}))} className="rounded-md border px-2 py-1">{saved[view.id]? 'Unsave':'Save'}</button>
                      <button onClick={()=>{ removePost(view.id); setView(null); }} className="rounded-md border px-2 py-1">Delete</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Edit Profile Modal */}
          {editing && (
            <div className="fixed inset-0 z-50 bg-black/40 grid place-items-center p-3" onClick={()=>setEditing(false)}>
              <div className="bg-white rounded-2xl border border-slate-200 w-full max-w-lg p-4" onClick={(e)=>e.stopPropagation()}>
                <div className="text-lg font-semibold mb-2">Edit Profile</div>
                <div className="grid gap-2">
                  <label className="text-sm">Full name<input value={draft.name||''} onChange={e=>setDraft(d=>({...d,name:e.target.value}))} className="mt-1 w-full rounded-lg border px-3 py-2"/></label>
                  <label className="text-sm">Username<input value={draft.username||''} onChange={e=>setDraft(d=>({...d,username:e.target.value}))} className="mt-1 w-full rounded-lg border px-3 py-2"/></label>
                  <label className="text-sm">Category<input value={draft.category||''} onChange={e=>setDraft(d=>({...d,category:e.target.value}))} className="mt-1 w-full rounded-lg border px-3 py-2"/></label>
                  <label className="text-sm">Website<input value={draft.website||''} onChange={e=>setDraft(d=>({...d,website:e.target.value}))} className="mt-1 w-full rounded-lg border px-3 py-2"/></label>
                  <label className="text-sm">Bio<textarea rows="3" value={draft.bio||''} onChange={e=>setDraft(d=>({...d,bio:e.target.value}))} className="mt-1 w-full rounded-lg border px-3 py-2"></textarea></label>
                  <div className="flex items-center gap-2"><button onClick={()=>avatarRef.current && avatarRef.current.click()} className="rounded-md border px-3 py-1">Change avatar</button><input ref={avatarRef} type="file" accept="image/*" className="hidden" onChange={onAvatar}/></div>
                </div>
                <div className="mt-3 flex items-center justify-end gap-2">
                  <button onClick={()=>setEditing(false)} className="rounded-md border px-3 py-1">Cancel</button>
                  <button onClick={()=>{ saveProfile(draft); setEditing(false); }} className="rounded-md px-3 py-1 btn-brand">Save</button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<Profile/>);
  </script>
</body>
</html>
