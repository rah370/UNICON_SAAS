<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>UNICON – For You</title>
  <link rel="icon" href="../UNICON.png?v=1758434378" type="image/png" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script defer crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root{ --brand-color:#1D4E89; }
    body{ font-family:Inter, ui-sans-serif, system-ui; background:#fbf7f3; color:#0f172a; }
    .wm{position:fixed;inset:0;pointer-events:none;background-repeat:no-repeat;background-position:center;background-size:min(60vw,680px);opacity:.08;z-index:0}
    .btn-brand{ background:var(--brand-color); color:#fff; }
  </style>
</head>
<body class="antialiased">
  <div class="wm" style="background-image:url('../UNICON.png?v=1758434378')" aria-hidden="true"></div>
  <main class="relative z-10 min-h-screen px-4 py-6">
    <header class="max-w-6xl mx-auto mb-4 flex items-center gap-3 justify-between">
      <div class="hidden md:flex items-center gap-2 flex-1 max-w-xl">
        <div class="relative flex-1">
          <svg class="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-400" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
          <input id="globalSearch" type="search" placeholder="Search…" class="w-full rounded-full border border-slate-200 bg-white px-10 py-2 text-sm" />
        </div>
      </div>
      <div class="relative flex items-center gap-2">
        <button title="Notifications" class="h-9 w-9 grid place-items-center rounded-full border border-slate-200 bg-white">🔔</button>
        <button id="userMenuBtn" title="Account" class="h-9 w-9 rounded-full border border-slate-200 bg-[var(--brand-color)] text-white grid place-items-center">👤</button>
        <div id="userMenu" class="hidden absolute right-0 top-12 w-60 rounded-2xl border border-slate-200 bg-white shadow-xl p-2">
          <a id="menuProfile" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-[var(--brand-color)]" href="javascript:void(0)">👤 Profile</a>
          <a id="menuSettings" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50" href="javascript:void(0)">⚙️ Settings</a>
          <a id="menuHome" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50" href="javascript:void(0)">🏠 My Home</a>
          <a id="menuHelp" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50" href="javascript:void(0)">❓ Help Center ↗</a>
          <div class="my-2 border-t"></div>
          <a id="menuLogout" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-slate-50 text-rose-600" href="javascript:void(0)">Log Out</a>
        </div>
      </div>
    </header>

    <section class="max-w-6xl mx-auto">
      <div id="root"><div class="rounded-2xl border border-slate-200 bg-white p-5 shadow-sm">Loading…</div></div>
    </section>
  </main>

  <nav class="fixed bottom-3 left-1/2 -translate-x-1/2 z-40">
    <ul class="flex gap-1 bg-white/90 backdrop-blur border border-slate-200 rounded-2xl p-1 shadow-xl">
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm btn-brand" href="for-you.html">For you</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="community.html">Community</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="messages.html">Messages</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="marketplace.html">Marketplace</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="calendar.html">Calendar</a></li>
      <li><a class="flex items-center gap-2 rounded-[1rem] px-4 py-2 text-sm text-slate-700 hover:bg-slate-100" href="profile.html">Profile</a></li>
    </ul>
</nav>
<script type="text/babel" data-presets="env,react">
  const { useState } = React;
  function getBranding(){ try { return JSON.parse(localStorage.getItem('uniconBrand')||'null'); }catch{ return null; } }
  function applyBranding(b){ const root = document.body; if (b?.color){ root.style.setProperty('--brand-color', b.color);} }
  const branding = getBranding(); applyBranding(branding);
  // header interactions
  (function(){
    const menuBtn = document.getElementById('userMenuBtn');
    const menu = document.getElementById('userMenu');
    if(menuBtn && menu){ menuBtn.addEventListener('click', (e)=>{ e.stopPropagation(); menu.classList.toggle('hidden'); }); document.addEventListener('click', ()=> menu.classList.add('hidden')); }
    function nav(id, href){ const el=document.getElementById(id); if(!el) return; el.addEventListener('click', ()=>{ if(id==='menuLogout'){ try{ localStorage.removeItem('uniconSessionEmail'); }catch{} } location.href = href; }); }
    nav('menuProfile','profile.html'); nav('menuSettings','settings.html'); nav('menuHome','for-you.html'); const help=document.getElementById('menuHelp'); if(help) help.addEventListener('click', ()=> window.open('https://example.com/help','_blank'));
    const input = document.getElementById('globalSearch'); if(input){ const saved=localStorage.getItem('unicon_global_search')||''; if(saved) input.value=saved; input.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ localStorage.setItem('unicon_global_search', input.value); try{ window.dispatchEvent(new CustomEvent('unicon_search',{ detail: input.value })); }catch{} } }); }
  })();
  function toast(message, type='info'){ try{ window.dispatchEvent(new CustomEvent('unicon_toast', { detail:{ message, type, id:String(Date.now()) } })); }catch{} }

  function ForYouFeed(){
    const [items, setItems] = React.useState(()=>{
      try{ return JSON.parse(localStorage.getItem('unicon_feed')||'null') || [
        { id: 'a1', title: 'Welcome back!', body: 'Orientation this Monday at 9:00 AM.', pinned: false, audience: 'All', likes:0, comments:[] },
        { id: 'a2', title: 'Book fair', body: 'Opens Wednesday in the main hall.', pinned: false, audience: 'All', likes:0, comments:[] },
      ]; }catch{ return []; }
    });
    const [title, setTitle] = React.useState('');
    const [body, setBody] = React.useState('');
    const [q, setQ] = React.useState('');
    const [editId, setEditId] = React.useState('');
    const [editTitle, setEditTitle] = React.useState('');
    const [editBody, setEditBody] = React.useState('');
    const canPost = true;
    React.useEffect(()=>{ try{ localStorage.setItem('unicon_feed', JSON.stringify(items)); }catch{} }, [items]);
    React.useEffect(()=>{ function on(e){ setQ(e.detail||''); } window.addEventListener('unicon_search', on); return ()=>window.removeEventListener('unicon_search', on); }, []);
    function add(){ if(!title.trim()||!body.trim()) return; setItems([{ id: String(Date.now()), title, body, pinned:false, audience:'All', likes:0, comments:[] }, ...items]); setTitle(''); setBody(''); }
    function like(id){ setItems(arr=> arr.map(i=> i.id===id? {...i, likes:(i.likes||0)+1 }: i)); }
    function addComment(id, text){ if(!text.trim()) return; setItems(arr=> arr.map(i=> i.id===id? {...i, comments:[...i.comments, { id:String(Date.now()), text }] }: i)); }
    function remove(id){ setItems(arr=> arr.filter(i=> i.id!==id)); }
    function startEdit(it){ setEditId(it.id); setEditTitle(it.title); setEditBody(it.body); }
    function saveEdit(){ if(!editTitle.trim()||!editBody.trim()) return; setItems(arr=> arr.map(i=> i.id===editId? { ...i, title:editTitle, body:editBody }: i)); cancelEdit(); }
    function cancelEdit(){ setEditId(''); setEditTitle(''); setEditBody(''); }
    function togglePin(id){ setItems(arr=> arr.map(i=> i.id===id? { ...i, pinned:!i.pinned }: i)); }
    const filtered = items.filter(i=> !q || i.title.toLowerCase().includes(q.toLowerCase()) || i.body.toLowerCase().includes(q.toLowerCase()));
    const sorted = [...filtered].sort((a,b)=> Number(b.pinned)-Number(a.pinned));
    return (
      <div className="space-y-4">
        <div className="flex items-center gap-2">
          <input value={q} onChange={e=>setQ(e.target.value)} placeholder="Search announcements" className="flex-1 rounded-lg border border-slate-300 px-3 py-2"/>
        </div>
        {canPost && (
          <div className="rounded-xl border border-slate-200 bg-white p-4 space-y-2">
            <div className="grid gap-2 md:grid-cols-2">
              <input value={title} onChange={e=>setTitle(e.target.value)} placeholder="Announcement title" className="rounded-lg border border-slate-300 px-3 py-2" />
            </div>
            <textarea value={body} onChange={e=>setBody(e.target.value)} placeholder="Write your update…" className="w-full rounded-lg border border-slate-300 px-3 py-2"></textarea>
            <button onClick={add} className="rounded-lg px-4 py-2 text-sm btn-brand">Post</button>
          </div>
        )}
        {sorted.map(it=> (
          <div key={it.id} className="rounded-2xl border border-slate-200 bg-white p-4 shadow-sm">
            {editId===it.id ? (
              <div className="space-y-2">
                <input value={editTitle} onChange={e=>setEditTitle(e.target.value)} className="w-full rounded-lg border border-slate-300 px-3 py-2" />
                <textarea value={editBody} onChange={e=>setEditBody(e.target.value)} className="w-full rounded-lg border border-slate-300 px-3 py-2" />
                <div className="flex items-center gap-2">
                  <button onClick={saveEdit} className="rounded-md px-3 py-1 btn-brand text-sm">Save</button>
                  <button onClick={cancelEdit} className="rounded-md px-3 py-1 border text-sm">Cancel</button>
                </div>
              </div>
            ) : (
              <>
                <div className="flex items-center justify-between mb-1">
                  <h3 className="font-semibold">{it.title}{it.pinned && <span className="ml-2 text-xs px-2 py-0.5 rounded-full" style={{ background:'color-mix(in srgb, var(--brand-color) 10%, white)', color:'var(--brand-color)' }}>Pinned</span>}</h3>
                  <div className="flex items-center gap-2 text-xs">
                    <button onClick={()=>togglePin(it.id)} className="rounded border px-2 py-0.5">{it.pinned? 'Unpin':'Pin'}</button>
                    <button onClick={()=>startEdit(it)} className="rounded border px-2 py-0.5">Edit</button>
                    <button onClick={()=>remove(it.id)} className="rounded border px-2 py-0.5">Delete</button>
                  </div>
                </div>
                <p className="text-slate-600">{it.body}</p>
              </>
            )}
            <div className="mt-3 flex items-center gap-3 text-sm">
              <button onClick={()=>like(it.id)} className="px-3 py-1 rounded-lg border border-slate-200 hover:bg-slate-50">👍 {it.likes||0}</button>
              <details className="flex-1">
                <summary className="cursor-pointer text-slate-600">Comments ({it.comments?.length||0})</summary>
                <div className="mt-2 space-y-2">
                  {(it.comments||[]).map(c=> (<div key={c.id} className="text-sm text-slate-700">• {c.text}</div>))}
                  <CommentBox onSubmit={(t)=>addComment(it.id, t)} />
                </div>
              </details>
            </div>
          </div>
        ))}
      </div>
    );
  }
  function CommentBox({ onSubmit }){
    const [t, setT] = React.useState('');
    return (
      <div className="flex gap-2">
        <input value={t} onChange={e=>setT(e.target.value)} placeholder="Write a comment" className="flex-1 rounded-lg border border-slate-300 px-3 py-1"/>
        <button onClick={()=>{ onSubmit(t); setT(''); }} className="px-3 py-1 rounded-lg btn-brand">Send</button>
      </div>
    );
  }

  function Events(){
    const defaults = [
      { id:'e1', title:'Hack Club Meet', time:'Wed 4:00 PM', featured: true },
      { id:'e2', title:'Career Talk', time:'Fri 2:00 PM', featured: false },
    ];
    const [events, setEvents] = useState(()=>{ try{ return JSON.parse(localStorage.getItem('unicon_events')||'null') || defaults; }catch{ return defaults; } });
    const [rsvp, setRsvp] = useState(()=>{ try{ return JSON.parse(localStorage.getItem('unicon_rsvp')||'null') || {}; }catch{ return {}; } });
    const [title, setTitle] = useState('');
    const [time, setTime] = useState('');
    React.useEffect(()=>{ try{ localStorage.setItem('unicon_events', JSON.stringify(events)); }catch{} }, [events]);
    React.useEffect(()=>{ try{ localStorage.setItem('unicon_rsvp', JSON.stringify(rsvp)); }catch{} }, [rsvp]);
    const [err, setErr] = useState('');
    function add(){ if(!title.trim()||!time.trim()){ setErr('Title and date/time are required.'); toast('Please fill all fields','error'); return; } setErr(''); setEvents([{ id:String(Date.now()), title, time, featured:false }, ...events]); setTitle(''); setTime(''); toast('Event created','success'); }
    function toggle(id){ setRsvp(s=> ({ ...s, [id]: !s[id] })); }
    return (
      <div className="space-y-4">
        <div className="bg-white rounded-xl border border-slate-200 p-4">
          <div className="font-medium mb-2">Create event</div>
          <div className="grid md:grid-cols-3 gap-2">
            <input value={title} onChange={e=>setTitle(e.target.value)} placeholder="Event title" className="rounded-lg border border-slate-300 px-3 py-2"/>
            <input value={time} onChange={e=>setTime(e.target.value)} placeholder="Date & time" className="rounded-lg border border-slate-300 px-3 py-2"/>
            <button onClick={add} className="rounded-lg px-3 py-2 text-sm btn-brand">Add</button>
          </div>
          {err && <div className="text-xs text-red-700 mt-2">{err}</div>}
        </div>
        <div className="space-y-3">
          {events.map(ev=> (
            <div key={ev.id} className="flex items-center justify-between rounded-lg border p-3 bg-white border-slate-200">
              <div>
                <div className="font-medium">{ev.title} — {ev.time}</div>
                {ev.featured && <div className="text-xs text-amber-700">Featured</div>}
              </div>
              <button onClick={()=>toggle(ev.id)} className={`rounded-md px-2 py-1 text-xs ${rsvp[ev.id]? 'text-green-700 bg-green-50 border border-green-200':'btn-brand'}`}>{rsvp[ev.id]? 'Going' : 'RSVP'}</button>
            </div>
          ))}
        </div>
      </div>
    );
  }

  function ForYouPage(){
    return (
      <div className="space-y-4">
        <div className="bg-white/80 backdrop-blur rounded-2xl p-3">
          <h2 className="text-xl font-semibold">Announcements</h2>
          <ForYouFeed/>
          <h3 className="text-lg font-semibold mt-4">Upcoming events</h3>
          <Events/>
        </div>
      </div>
    );
  }

  const root = ReactDOM.createRoot(document.getElementById('root'));
  root.render(<ForYouPage/>);
</script>
</body>
</html>
